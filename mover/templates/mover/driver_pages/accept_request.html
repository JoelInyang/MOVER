{% extends "mover/map_base.html" %}
{% load static %}

{% block title %}
<title>Accept Request</title>
<style>
    .mover-request-list p {
        line-height: 0.5em;
        font-size: 14px;
    }

    div.driver-accept-list:hover {
        background-color: #E0F0EE;
    }
</style>
{% endblock title %}

{% block cardRight %}


<div>
    <h3>Available nearby requests</h3>
    <p class="text-small">Move items that work best for you!</p>
    <!-- If driver can accept request show all bookings wihtout a driver asigned -->
    {% if can_accept_request %}
    <div class=" mb-4">
        {% for booking in bookings %}
        <div class="driver-accept-list p-2">
            <div class="d-flex flex-row gap-2 justify-content-between">
                <div class="d-flex flex-row gap-2">
                    <div>
                        {% if booking.photo %}
                        <img src="{{ booking.photo.url }}" alt="" width=" 174px" height="106px" class="rounded">
                        {% else %}
                        <img src="{% static 'images/no-image.png' %}" alt="" width=" 174px" height="106px"
                            class="rounded">
                        {% endif %}
                    </div>
                    <div class="mover-request-list">
                        <p><b>{{ booking.selected_item }} Items </b></p>
                        <p style="color: #104333;" class="text-uppercase fw-bold">{{ booking.service_type }}</p>
                        <p>
                            <b style="color: #4A4A68;">Pick-up location:</b>
                            {{ booking.pickup_location }}
                        </p>
                        <p><b style="color: #4A4A68;">Est. driving distance:</b> 20 min</p>
                        <p>Note: {{ booking.note|truncatechars:28 }} </p>
                    </div>
                </div>
                <div class="d-flex flex-column justify-content-center align-items-center">
                    {% if booking.rate_type == "FX" %}
                    <p class="mb-2">${{ user.fixed_amount }} / Fixed</p>
                    {% else %}
                    <p class="mb-2">${{ user.hourly_amount }} / Hourly</p>
                    {% endif %}
                    <form action="{% url 'ready_to_move' %}" method="POST">
                        {% csrf_token %}
                        {{ form.errors }}
                        <input type="hidden" name="tracking_id" value="{{ booking.tracking_id }}">
                        <button type="submit">Accept</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- If the bookings s empty show below -->
        {% empty %}
        <div>There are currently no available orders...</div>
        {% endfor %}
    </div>

    {% else %}
    <!-- Else, the driver already accepted a request so cant accept another. Show show the unfufuilled order -->
    <p class="p-3" style="background-color: #E0F0EE;">You can't accept new requests.
        You still have unfulfilled requests.</p>

    <div class="mb-4">
        <!-- Loop throught the unfufuilled query set -->
        {% for booking in unfufuilled_booking %}
        <div class="driver-accept-list p-2">
            <div class="d-flex flex-row gap-2 justify-content-between">
                <div class="d-flex flex-row gap-2 ">
                    <div>
                        <img src="{{ booking.photo.url }}" alt="" width=" 174px" height="106px" class="rounded">
                    </div>
                    <div class="mover-request-list">
                        <p><b>{{ booking.selected_item }} Items </b></p>
                        <p style="color: #104333;" class="text-uppercase fw-bold">{{ booking.service_type }}</p>
                        <p>
                            <b style="color: #4A4A68;">Pick-up location:</b>
                            {{ booking.pickup_location }}
                        </p>
                        <p>
                            <b style="color: #4A4A68;">Pick-up location:</b>
                            {{ booking.dropoff_location }}
                        </p>
                        <p><b style="color: #4A4A68;">Est. driving distance:</b> 20 min</p>
                        <p>Note: {{ booking.note|truncatechars:28 }} </p>
                    </div>
                </div>
                <div class="d-flex flex-column justify-content-center align-items-center">
                    <p><span class="badge bg-danger" style="font-weight: 500;">Unfulfilled
                        </span></p>
                    {% if booking.rate_type == "FX" %}
                    <p class="mb-2">${{ user.fixed_amount }} / Fixed</p>
                    {% else %}
                    <p class="mb-2">${{ user.hourly_amount }} / Hourly</p>
                    {% endif %}
                    <form action="{% url 'fulfill_request' booking.id %}" method="POST">
                        {% csrf_token %}
                        {{ form.errors }}
                        <input type="hidden" name="tracking_id" value="{{ booking.tracking_id }}">
                        <button type="submit">Fulfilled?</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock cardRight %}